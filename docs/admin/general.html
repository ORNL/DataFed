<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Administration &mdash; DataFed 1.4 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=c9ed3d4e"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Project Management" href="../dev/project.html" />
    <link rel="prev" title="datafed.Version_pb2" href="../autoapi/datafed/Version_pb2/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DataFed
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About DataFed</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../system/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/overview.html">System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/usecases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/papers.html">Papers and Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/getting_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Web Portal</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/web/portal.html">Web Portal Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Client Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/client/install.html">Installation and Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Command Line Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/cli/guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/cli/reference.html">Command Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/python/high_level_guide.html">Guide to High Level Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/python/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Administration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#system-deployment">System Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#downloading-datafed-installing-dependencies">Downloading DataFed &amp; Installing Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-installation-configuration">General Installation &amp; Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#database">Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#core-service">Core Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web-service">Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-repository">Data Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authz-library">Authz Library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#networking">Networking</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/project.html">Project Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/design.html">Architecture &amp; Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/release.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/roadmap.html">Feature Road Map</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DataFed</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Administration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="administration">
<h1>Administration</h1>
<section id="system-deployment">
<h2>System Deployment</h2>
<p>Deploying DataFed requires building, installing, and configuring DataFed service as well as several
third-party packages/services. The process described here is manual, but the goal is to eventually
automate this process as much as possible (via container technology). The services to be deployed
relate to either the DataFed “Central Services” (of which there is only one instance) and DataFed
“Data Repositories”. (These services are listed below.)</p>
<p>The hardware configuration selection depends on desired performance/cost and can range from a single
node/VM up to a dedicated high-performance cluster. The host operating system must be Linux, but
the specific distribution is not important. Though through testing at the moment
has been limited to ubuntu:focal.</p>
<p>Central Services:
- DataFed Core Service
- DataFed Web Service
- Arango Database</p>
<p>DataFed central services include the Core service, the database, and the web service. These
services may be installed together on a single node, or across multiple nodes. If the latter
is chosen, it is strongly recommended that a high-speed private network be used in order to
reduce latency and avoid the need for TLS connections.</p>
<p>Data Repository:
- DataFed Repository Service
- Globus Connect Service (version 4)
- DataFed GridFTP AUTHZ Module</p>
<p>Client Applications:
- DataFed Python Client</p>
</section>
<section id="downloading-datafed-installing-dependencies">
<h2>Downloading DataFed &amp; Installing Dependencies</h2>
<p>To deply DataFed, it must be built from source code hosted on <a class="reference external" href="https://github.com/ORNL/DataFed">GitHub</a>.
Prior to building DataFed, the build environment must be properly configured as described below
(the examples are based on Debian). Min/max version restrictions are listed later in the Dependencies section.</p>
<p>Downloading DataFed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/ORNL/DataFed.git
</pre></div>
</div>
<p>Install packages required to build DataFed:</p>
<ul class="simple">
<li><p>g++</p></li>
<li><p>git</p></li>
<li><p>cmake</p></li>
<li><p>libboost-all-dev</p></li>
<li><p>protobuf-compiler</p></li>
<li><p>libzmq3-dev</p></li>
<li><p>libssl-dev</p></li>
<li><p>libcurl4-openssl-dev</p></li>
<li><p>libglobus-common-dev</p></li>
<li><p>libfuse-dev</p></li>
<li><p>nodejs</p></li>
<li><p>npm</p></li>
</ul>
<p>The npm packages needed primarily by the web server are:</p>
<ul class="simple">
<li><p>express</p></li>
<li><p>express-session</p></li>
<li><p>cookie-parser</p></li>
<li><p>helmet</p></li>
<li><p>ini</p></li>
<li><p>protobufjs</p></li>
<li><p>zeromq</p></li>
<li><p>ect</p></li>
<li><p>client-oauth2</p></li>
</ul>
<p>This can be done with a helper scripts these scripts are for ubuntu:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/install_core_dependencies.sh
./DataFed/scripts/install_repo_dependencies.sh
./DataFed/scripts/install_ws_dependencies.sh
</pre></div>
</div>
<p>The next step is to enter configuration options that are listed in ./config/datafed.sh. To
generate a template for this file you will first need to run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/generate_datafed.sh
</pre></div>
</div>
<p>These options can be used create the required services and configuration files. Below are a list
of the configuration options:</p>
<ol class="arabic simple">
<li><p>DATAFED_DEFAULT_LOG_PATH - Needed by core, repo, web services</p></li>
<li><p>DATAFED_DATABASE_PASSWORD - Needed by core</p></li>
<li><p>DATAFED_ZEROMQ_SESSION_SECRET - Needed by web server</p></li>
<li><p>DATAFED_LEGO_EMAIL - Needed by web server</p></li>
<li><p>DATAFED_WEB_KEY_PATH - Needed by web server</p></li>
<li><p>DATAFED_WEB_CERT_PATH - Needed by web server</p></li>
<li><p>DATAFED_GLOBUS_APP_ID - Needed by core server</p></li>
<li><p>DATAFED_GLOBUS_APP_SECRET - Needed by core server</p></li>
<li><p>DATAFED_SERVER_PORT - Needed by repo server</p></li>
<li><p>DATAFED_DOMAIN - Needed by repo, web and authz</p></li>
<li><p>DATAFED_GCS_ROOT_NAME - Needed by repo and authz by Globus</p></li>
<li><p>DATAFED_GCS_COLLECTION_ROOT_PATH - Needed by repo and authz for Globus</p></li>
<li><p>DATAFED_REPO_ID_AND_DIR - Needed for repo and authz</p></li>
</ol>
<p>Descriptions of what these variables are can also be found in the ./config/datafed.sh file. Once the
necessary variables have been provided a series of scripts have been developed to appropriately
automatically configure much of the setup.</p>
</section>
<section id="general-installation-configuration">
<h2>General Installation &amp; Configuration</h2>
<p>DataFed configuration files will by default be placed in:</p>
<p>/opt/datafed/keys
/opt/datafed/authz
/opt/datafed/repo
/opt/datafed/core
/opt/datafed/web</p>
<p>Log files will by default be placed in:</p>
<p>/var/log/datafed</p>
<p>Services will by default be installed in:</p>
<p>/etc/systemd/system folder</p>
<p>The authz configuration for GridFTP will be installed in the following path:</p>
<p>/etc/grid-security</p>
<section id="database">
<h3>Database</h3>
<p>Steps to deploy DataFed Database:</p>
<ol class="arabic simple">
<li><p>Download and install the latest ArangoDB server package for your host operating system. (see example, below)</p></li>
</ol>
<p>Example download/install of ArangoDB 3.7 for Ubuntu:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>wget https://download.arangodb.com/arangodb37/Community/Linux/arangodb3_3.7.10-1_amd64.deb
sudo apt install ./arangodb3_3.7.10-1_amd64.deb
</pre></div>
</div>
<p>It should start automatically with an install but to run the arangodb service, you
can also interact with it via systemctl:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo systemctl start arangodb3.service
</pre></div>
</div>
<p>We will then need to install the foxx services on the same machine as the
arngodb database. Building and installing foxx service:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd DataFed
mkdir build
cmake -S . -B build -DBUILD_REPO_SERVER=False -DBUILD_AUTHZ=False \
                -DBUILD_CORE_SERVER=False -DBUILD_WEB_SERVER=False \
                -DBUILD_DOCS=False -DBUILD_PYTHON_CLIENT=False \
                -DBUILD_FOXX=True
cmake --build build --parallel 6
sudo cmake --build --target install
</pre></div>
</div>
</section>
<section id="core-service">
<h3>Core Service</h3>
<p>For a DataFed core server, start by generate the core server config file - a
datafed.sh file must exist in DataFed/config/ before calling this script:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/generage_core_config.sh
</pre></div>
</div>
<p>Build the core service file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/generage_core_service.sh
</pre></div>
</div>
<p>Building the compiling the core service:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd DataFed
mkdir build
cmake -S . -B build -DBUILD_REPO_SERVER=False -DBUILD_AUTHZ=False \
                -DBUILD_CORE_SERVER=True -DBUILD_WEB_SERVER=False \
                -DBUILD_DOCS=False -DBUILD_PYTHON_CLIENT=False \
                -DBUILD_FOXX=False
cmake --build build --parallel 6
sudo cmake --build --target install
</pre></div>
</div>
<p>Example datafed-core.cfg file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>port = 9100
client-threads = 4
task-threads = 4
db-url = http://127.0.0.1:8529/_db/sdms/api/
db-user = root
db-pass = &lt;password&gt;
cred-dir = /opt/datafed/keys
client-id = &lt;Globus App ID&gt;
client-secret = &lt;Globus App Secret&gt;
</pre></div>
</div>
<p>To run the service:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo systemctl start datafed-core.service
</pre></div>
</div>
</section>
<section id="web-service">
<h3>Web Service</h3>
<p>For a DataFed web server, start by generate the web server config file - a
datafed.sh file must exist in DataFed/config/ before calling this script:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/generage_ws_config.sh
</pre></div>
</div>
<p>In addition, the web server will need to be placed on a machine with a domain
name and for public access a public ip address. If this is the case there is
a helper script to generate the certificates for you using let’s encrypt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./install_lego_and_certificates.sh
</pre></div>
</div>
<p>If using your own certificates, by default datafed will look for them in the
path, you can see where exactly it is looking by opening the config file
in /opt/datafed/web/, note they will only appear there after calling the cmake
install command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/datafed/keys
</pre></div>
</div>
<p>Build the web service file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/generage_ws_service.sh
</pre></div>
</div>
<p>Building the web service:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd DataFed
mkdir build
cmake -S . -B build -DBUILD_REPO_SERVER=False -DBUILD_AUTHZ=False \
                -DBUILD_CORE_SERVER=False -DBUILD_WEB_SERVER=True \
                -DBUILD_DOCS=False -DBUILD_PYTHON_CLIENT=False \
                -DBUILD_FOXX=False
cmake --build build --parallel 6
sudo cmake --build --target install
</pre></div>
</div>
<p>It should start automatically with an install but to run the web service, you
can also interact with it via systemctl:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo systemctl start datafed-ws.service
</pre></div>
</div>
</section>
<section id="data-repository">
<h3>Data Repository</h3>
<p>For a DataFed data repository, install Globus Connect v4 or v5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo curl -LOs https://downloads.globus.org/toolkit/globus-connect-server/globus-connect-server-repo_latest_all.deb
sudo dpkg -i globus-connect-server-repo_latest_all.deb
sudo apt-get update
sudo apt-get install globus-connect-server
</pre></div>
</div>
<p>If using Globus Connect Server v5 there is a helper script to help set up your
local collections correctly:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/globus/setup_globus.sh
</pre></div>
</div>
<p>There will be instructions you will need to follow after running the scirpt,
which require manual interaction with the Globus web server. Once a guest
collection has been created, you will then be able to register the DataFed repo
server with the DataFed administrator. The information needed to connect the
repo server to the core server can be accessed by running:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/globus/generate_repo_form.sh
</pre></div>
</div>
<p>Generate the repo config file - a datafed.sh file must exist in DataFed/config/
before calling this script:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/generage_repo_config.sh
</pre></div>
</div>
<p>Build the repo service file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/generage_repo_service.sh
</pre></div>
</div>
<p>Building the repo service:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd DataFed
mkdir build
cmake -S . -B build -DBUILD_REPO_SERVER=True -DBUILD_AUTHZ=False \
                -DBUILD_CORE_SERVER=False -DBUILD_WEB_SERVER=False \
                -DBUILD_DOCS=False -DBUILD_PYTHON_CLIENT=False \
                -DBUILD_FOXX=False
cmake --build build --parallel 6
sudo cmake --build --target install
</pre></div>
</div>
<p>It should start automatically with an install but to run the repo service, you
can also interact with it via systemctl:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo systemctl start datafed-repo.service
</pre></div>
</div>
</section>
<section id="authz-library">
<h3>Authz Library</h3>
<p>Generate the authz config file - a datafed.sh file must exist in DataFed/config/
before calling this script:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./DataFed/scripts/generage_authz_config.sh
</pre></div>
</div>
<p>Building the authz library for Globus version 5, note you should install authz
library on the same machine as a Globus Connect Server:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd DataFed
mkdir build
cmake -S . -B build -DBUILD_REPO_SERVER=False -DBUILD_AUTHZ=True \
                -DBUILD_CORE_SERVER=False -DBUILD_WEB_SERVER=False \
                -DBUILD_DOCS=False -DBUILD_PYTHON_CLIENT=False \
                -DBUILD_FOXX=False -DGLOBUS_VERSION=5
cmake --build build --parallel 6
sudo cmake --build --target install
</pre></div>
</div>
<p>At this point you will want to restart the globus-gridft-server:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo systemctl restart globus-gridft-server.service
</pre></div>
</div>
</section>
</section>
<section id="networking">
<h2>Networking</h2>
<p>If the web server and core server are on different machines you will need to
ensure that they can communicate, this will require exchanging the public keys
that are in the /opt/datafed/keys folder.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../autoapi/datafed/Version_pb2/index.html" class="btn btn-neutral float-left" title="datafed.Version_pb2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../dev/project.html" class="btn btn-neutral float-right" title="Project Management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Oak Ridge National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
